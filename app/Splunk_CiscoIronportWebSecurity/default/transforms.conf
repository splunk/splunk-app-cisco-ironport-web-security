

###################################
# Removes Comments from Log Files #
###################################

[nullPound]
REGEX = ^\#
DEST_KEY = queue
FORMAT = nullQueue


##################################
# Regex to read WSA squid format #
##################################

# default squid format #

[wsa_squid_base]
REGEX = (?<end_time>\d+\.\d+)\s(?<duration>\d+)\s(?<c_ip>\S+)\s(?<http_result>\S+)\s(?<sc_bytes>\S+)\s(?<cs_method>\S+)\s(?<cs_url>\S+)\s(?<cs_username>\S+)\s(?<hierarchy>\S+)\s(?<cs_mime_type>\S+)\s(?<x_acl_tag>\S+)\s(?<x_scan_verdict>\<.*\>)\s\S+\s(?<x_custom_fields>.*)$

# custom fields #
# these are required custom fields for Cisco Security Suite #
# add in the following WSA custom codes, in order: "%u %<Referer: %k %g %XE %q" #
# see the AsyncOS user guide for more details on custom log formatting #

[wsa_squid_custom]
SOURCE_KEY = x_custom_fields
# for additional custom fields like referrer, etc, add them on to the end of the line below #
REGEX = (\"(?<cs_user_agent>.*)\"|\-)\s(\"(?<referer>\S+)\"|\-)\s(?<dest_ip>\S+)\s(\"(?<x_webcat_code_full>.*)\"|\-)(\s(?<cs_bytes>\d+))?


[fieldsplit_x_scan_verdict]
SOURCE_KEY = x_scan_verdict
REGEX= \<(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?(?:\[)?([^\,\"\]]+)(?:\])?(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\,(?:\")?([^\,\"]+)(?:\")?\>
FORMAT = x_webcat_code_abbr::$1 x_wbrs_score::$2 x_webroot_scanverdict::$3 x_webroot_threat_name::$4 x_webroot_trr::$5 x_webroot_spyid::$6 x_webroot_trace_id::$7 x_mcafee_scanverdict::$8 x_mcafee_filename::$9 x_mcafee_scan_error::$10 x_mcafee_detecttype::$11 x_mcafee_av_virustype::$12 x_mcafee_virus_name::$13 x_sophos_scanverdict::$14 x_sophos_scancode::$15 x_sophos_filename::$16 x_sophos_virus_name::$17 x_ids_verdict::$18 x_icap_verdict::$19 x_webcat_req_code_abbr::$20 x_webcat_resp_code_abbr::$21 x_resp_dvs_threat_name::$22 x_wbrs_threat_type::$23 x_avc_app::$24 x_avc_type::$25 x_avc_behavior::$26 x_request_rewrite::$27 x_avg_bw::$28 x_bw_throttled::$29 x_user_type::$30 x_resp_dvs_verdictname::$31 x_req_dvs_threat_name::$32 x_suspect_user_agent::$33 x_wbrs_threat_reason::$34


[fieldsplit_x_acl_tag]
SOURCE_KEY = x_acl_tag
REGEX = (?<acl_decision_tag>[A-Z_]+)((-[A-Z_]+)?_\d+)?-(?<access_policy>\w+)-(?<identity>\w+)-(?<outbound_malware_policy>\w+)-(?<data_security_policy>\w+)-(?<external_dlp_policy>\w+)-(?<routing_policy>\w+)
# need to cater for occasional extra field - CSCum31635
#     PASSTHRU_ADMIN-DEFAULT_ACTION_7-DefaultGroup-CyberRange_Inside_NoAuth-NONE-NONE-NONE-DefaultGroup
# workaround currently not really working for above example 

[fixup_acl_decision_tag]
# additional fixup for funky formats.  may not be necessary / work though? #
SOURCE_KEY = acl_decision_tag
REGEX = (?<acl_decision_tag>[A-Z_]+)-[A-Z_]+

#[fieldsplit_acl_decision_tag]
#SOURCE_KEY = acl_tag_decision_tag
#REGEX = (?<acl_decision_tag>\w+)(_\d\d)

[fieldsplit_user_id_dom]
SOURCE_KEY = cs_username
REGEX = \"((?<user_domain_nt>\w+)\\)?(?<user_id>\w+)@(?<user_domain_fqdn>\S+)\"

[fieldsplit_url]
SOURCE_KEY = cs_url
REGEX = ^(?<cs_url_scheme>[^:/?#]+)://(?<cs_url_host>[\w\d\.-]+)(:(?<cs_url_port>\d{0,5}))?(?<cs_url_stem>[^?#\s]*)(\?(?<cs_url_query>[^#|^\s]*))?(#(?<cs_url_fragment>.*[^\s]))?


[fieldsplit_dest_domain]
SOURCE_KEY = cs_url_host
REGEX = ([^\.]+\.(?<dest_domain>.*))

[fieldsplit_http_result]
SOURCE_KEY = http_result
REGEX = (?<sc_result>\w+)/(?<sc_http_status>\d+)

[fieldsplit_hierarchy]
SOURCE_KEY = hierarchy
REGEX = (?<s_hierarchy>\S+)/(?<s_from>\S+)


##################################
# Regex to read L4TM squid format #
##################################

[l4tm]
REGEX = ^[A-Za-z]* ([A-Za-z]* +[0-9]* [0-9:]* [0-9]*) [A-Za-z]*: Firewall ([A-Za-z]*) ([A-Z]*) data from ([0-9.]*):[0-9.]* to ([0-9.]*)\([A-Za-z.]*\):[0-9]+.
FORMAT = end_time::$1 field_action::$2 field_protocol::$3  source_ip::$4  field_destination_ip::$5  field_destination_host::$6	field_destination_port::$7	


##################################
#       Lookup Tables            #
##################################

[cisco_wsa_vendor_info_lookup]
filename = cisco_wsa_vendor_info.csv

[acl_decision_tags_lookup]
filename = acl_decision_tags.csv

[transaction_result_lookup]
filename = transaction_results.csv
